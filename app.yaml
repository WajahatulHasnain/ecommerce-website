runtime: nodejs18
env: standard

automatic_scaling:
  min_instances: 0
  max_instances: 10
  target_cpu_utilization: 0.6

env_variables:
  NODE_ENV: production
  # Add your MongoDB Atlas connection string here
  MONGODB_URI: mongodb+srv://username:password@cluster.mongodb.net/ecommerce?retryWrites=true&w=majority
  # Add your JWT secret here
  JWT_SECRET: your-super-secret-jwt-key-here-make-it-long-and-random
  # Add your Resend API key here (for emails)
  RESEND_API_KEY: re_your_resend_api_key_here
  # This will be auto-generated by Google Cloud
  FRONTEND_URL: https://clicknbuy-479111.appspot.com
  PORT: 8080

handlers:
# Serve uploaded images
- url: /uploads/(.*)
  static_files: backend/uploads/\1
  upload: backend/uploads/.*

# API routes to backend
- url: /api/.*
  script: auto

# All other routes serve the React frontend
- url: /.*
  static_files: frontend/dist/index.html
  upload: frontend/dist/index.html

# Static assets for frontend
- url: /static/(.*)
  static_files: frontend/dist/static/\1
  upload: frontend/dist/static/.*

- url: /assets/(.*)
  static_files: frontend/dist/assets/\1
  upload: frontend/dist/assets/.*